!function(a,b){function c(){if(m.debug){var a=arguments;if("object"==typeof a){var b=null;a=[];for(b in arguments)arguments.hasOwnProperty(b)&&a.push(arguments[b])}a.reverse(),a.push(m.logPrefix),a.reverse(),console.log.apply(console,a)}}function d(a){return a=a||"uid_",a+""+(new Date).getTime()+parseInt(1e3*Math.random(),0)}function e(a){return a instanceof EventRouter||a&&a.constructor&&"EventRouter"===a.constructor.name}function f(a,b){this.id=d("eiid_"),this.event=b,this.module=a}function g(a){a=a||{},m.debug="boolean"==typeof a.verbose?a.verbose:!1,a.eventRouter&&this.useRouter(a.eventRouter)}function h(a){return i=i instanceof g?i:new g(a)}var i={},j={},k={},l={},m={debug:!1,logPrefix:"[CommunicationHub]"};f.prototype.interceptEvent=function(a){a=a||!1;var b=this,d=this.module.handlers[this.event];try{c("Attempting to route event:",this.event,"[module: "+this.module.id+"]"),l.route(this.event,a,function(c){b.module.target[d].call(b.module.target,b.event,c||a)})}catch(e){c("EventRouter not found. Triggering handler for event:",this.event,"[module: "+this.module.id+"]",e.message),this.module.target[d].call(this.module.target,this.event,a)}};var n={_interceptors:{},create:function(a,b){return this._interceptors[a]=this._interceptors[a]||[],this._interceptors[a].push(new f(b,a)),c("Successfully created EventInterceptor for event:",a,"[module: "+b.id+"]"),this._interceptors[a][this._interceptors[a].length-1]},invokeInterceptors:function(a,b){var d=-1,e=this._interceptors[a]||[];if(!this._interceptors[a])return void c("No event interceptors found for event:",a);for(;e[++d];)e[d].interceptEvent(b)},removeInterceptor:function(a){var b=null;for(b in this._interceptors)if(this._interceptors.hasOwnProperty(b))for(var d=-1;this._interceptors[b][++d];){var e=this._interceptors[b][d];if(e.id===a)try{delete this._interceptors[b][d],c("Interceptor removed succesfully.",e.event,e.id)}catch(f){c("Can't remove interceptor",f)}}},removeAllInterceptors:function(){var a=null;for(a in this._interceptors)if(this._interceptors.hasOwnProperty(a))try{delete this._interceptors[a]}catch(b){c("Can't remove interceptor",b)}}};g.prototype.registerModule=function(a){var b=d("mid_"),c=j[b]=a,e=null;c.id=b,c.target.__id=b;for(e in c.handlers)k[e]=k[e]||{},k[e]={module_id:b,interceptor_id:n.create(e,c).id};return!0},g.prototype.deregisterModule=function(a){for(var b=a.events,c=(a.target.__id,0),d=b[c];d;)n.removeInterceptor(k[d].interceptor_id),delete k[d],c+=1,d=b[c]},g.prototype.emit=function(a,b){n.invokeInterceptors(a,b)},g.prototype.useRouter=function(a){if(!e(a))throw"Argument is not an instance of EventRouter class.";l=a},g.prototype.reset=function(){j={},k={},l={},n.removeAllInterceptors()},a.CommunicationHub=h}(function(){return"undefined"!=typeof GLOBAL?GLOBAL:window}());