<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: CommunicationHub.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: CommunicationHub.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>(function (exports, undefined) {
    
    /**
     * COMMUNICATION HUB
     * 
     * The purpose of the hub is to assure indirect communication between elements of an application, i.e. modules,
     * as well as to tie up actions to certain communication events. The idea is to broadcast an event along with some data,
     * then capture the event, forward it to an event filter which checks whether there are any actions assigned to it. If there
     * are, then they are triggered (for instance saves passed data to a DB), and once the actions have finished, the event is
     * passed on along with data, to one or more independent modules, which are listening the event.
     * 
     * 1. ModuleA 	--> 	registers "jump" listener in the hub
     * 2. TheHub 	--> 	creates an event interceptor for ModuleA and "jump" event
     * 3. ModuleB 	--> 	triggers "jump" event along with some data
     * 4. TheHub 	--> 	the interceptor detects the event and forwards it to the event filter, which checks whether we have any actions
     * 						for that event, to be triggered before the event is passed on to a recipient
     * 5. TheHub	-->		once all actions have been triggered and completed, the event is passed back to the interceptor and the interceptor
     * 						executes an event handler of a recipient
     * 6. ModuleA	-->		responds to the "jump" event
     * 
     * ## &lt;HOW-TO> ##
     * 		
     * 		var CommHub = new CommunicationHub();
     * 
     * 		function MyModule() {
     * 			function jumpEventHandler(event, data) {
     * 				console.log(event); // "jump"
     * 				console.log(data.animal); // "rabbit"
     * 				console.log(data.name); // "Roger"
     * 			}
     * 
     * 			CommHub.registerModule({
     * 				target: this,
     * 				handler: { "jump" : jumpEventHandler }
     * 			});
     * 		}
     * 
     * 		var myModule = new MyModule();
     * 
     * 		CommHub.triggerEvent("jump", {animal: "rabbit", name: "Roger"});
     * 
     * ## &lt;/HOW-TO> ##
     * 
     * @module
     * @name 	CommunicationHub
     */
	function CommunicationHub() {

        var _modules 			= {}, // holds a list of registered modules
            _events 			= {}, // holds references to modules and interceptors, grouped by event name
            _interceptors 		= {}, // holds a list of all event interceptors
            _interceptorFactory = {}; // a placeholder for the interceptor factory

        /**
         * Returns a unique id generated on a basis of current time stamp + random number and prepended with a custom or default prefix.
         * 
         * @method 	generateUID
         * @param	{Srting} prefix		A string the ID is to be prefixed with. Default: 'uid_'
         * @private
         * @returns	{String}
         */
        function generateUID(prefix) {
            prefix = prefix || 'uid_';
            return prefix + (new Date()).getTime() + '' + parseInt(Math.random() * 1000, 0);
        }

        /**
         * EventInterceptor constructor.
         * 
         * @method	EventInterceptor
         * @param	{String} 	event		Name of the event to intercept.
         * @param	{Function} 	handler		Event handler.
         * @private
         */
        function EventInterceptor(event, handler) {
            var _self = this;

            this.id 		= generateUID('eiid_');
            this.handler 	= handler;
            this.event 		= event;

            // TODO - this method is temporary. There should be a module for triggering actions associated with events, instead of this.
            function forwardEvent(data) {
                this.handler.call(this.object, this.event, data);
            }

            // triggered by _iterceptorFactory
            this.interceptEvent = function (data) {
                data = data || null;
                forwardEvent.call(this, data);
            };
        }

        /**
         * A factory to facilitate creating new interceptors and triggering events on them, based on event type.
         * 
         * @module	(self revealing)
         * @name	_interceptorFactory
         * @private
         * @returns	{Object} Returns aliases to methods which meant to be public.
         */
        _interceptorFactory = (function (EventInterceptor, _interceptors) {
            
            /**
             * Instantiates a new EventInterceptor and saves the instance in an array of interceptors associated with the same event.
             * 
             * @method	create
             * @param	{String}	e			Event name.
             * @param	{Function} 	listener	Event listener.
             * @returns {EventInterceptor}
             */
            function create(e, listener) {
                _interceptors[e] = _interceptors[e] || [];
                _interceptors[e].push((new EventInterceptor(e, listener)));

                return _interceptors[e][_interceptors[e].length - 1];
            }

           	/**
           	 * Finds an array of event interceptors assigned to the event and triggers iterceptEvent method
           	 * of all the interceptors from the array.
           	 * 
           	 * @method	triggerEvent
           	 * @param	{String}	e		Event name.
           	 * @param	{*}			data	Data to be passed through to recipients.
           	 * @private
           	 */
            function triggerEvent(e, data) {
                var i = -1,
                    eventInterceptors = _interceptors[e];

                while (eventInterceptors[++i]) {
                    eventInterceptors[i].interceptEvent(data);
                }
            }

            // make some methods available publicly
            return {
                create: create,
                triggerEvent: triggerEvent
            };
        }(EventInterceptor, _interceptors));

        /**
         * Registers a module listening on events passed through as parameters.
         * 
         * @method	registerModule
         * @param	{Object}	params	Expected parameters:
         * 								- target	A reference to the module.
         * 								- listeners	An object containing event name{String}-handler{Function} pairs (e.g. { "myEvent" : myEventHandler })
         */
        this.registerModule = function (params) {
            var id 		= generateUID('mid_'),
                module 	= _modules[id] = params,
                e 		= "";

            module.id = id;

            // go through all handlers
            for (e in module.handlers) {
                _events[e] = _events[e] || [];
                _events[e].push({
                    module_id 		: id,
                    interceptor_id	: _interceptorFactory.create(e, module.handlers[e]).id
                });
            }
        };

        /**
         * A public alias to _interceptorFactory.triggerEvent method.
         * 
         * @method	broadcastEvent
         * @param	{String}	e 		Event name.
         * @param	{*}			data	Data to be passed through to event hadlers/recipients.
         */
        this.broadcastEvent = function (e, data) {
            _interceptorFactory.triggerEvent(e, data);
        };
    }

    // make the module available globally
	exports.CommunicationHub = CommunicationHub;

}(GLOBAL || window));

var hub = new CommunicationHub();

function mod1() {
    function jumpHandler() {
        console.log('mod1: i am jumping');
    }

    hub.registerModule({
        target: this,
        handlers: {'jump': jumpHandler}
    });
}
var m1 = new mod1();

function mod2() {
    function runHandler() {
        console.log('mod2: i am running');
    }

    hub.registerModule({
        target: this,
        handlers: {'run': runHandler}
    });
}
var m2 = new mod2();

function mod3() {
    function swimHandler() {
        console.log('mod3: i am swimming');
    }

    hub.registerModule({
        target: this,
        handlers: {'swim': swimHandler}
    });
}
var m3 = new mod3();

function mod4() {
    function runHandler(e, data) {
        console.log('mod4: i am running too');
    }

    function swimHandler() {
        console.log('mod4: i am swimming too');
    }

	hub.registerModule({
        target: this,
        handlers: {'run': runHandler, 'swim': swimHandler}
    });
}
var m4 = new mod4();

hub.broadcastEvent('run', {foo:1, bar:2});
// hub.broadcastEvent('swim', null);
// hub.broadcastEvent('jump', null);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-_interceptorFactory.html">_interceptorFactory</a></li><li><a href="module-CommunicationHub.html">CommunicationHub</a></li></ul><h3>Global</h3><ul><li><a href="global.html#broadcastEvent">broadcastEvent</a></li><li><a href="global.html#create">create</a></li><li><a href="global.html#EventInterceptor">EventInterceptor</a></li><li><a href="global.html#generateUID">generateUID</a></li><li><a href="global.html#registerModule">registerModule</a></li><li><a href="global.html#triggerEvent">triggerEvent</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Fri Jun 27 2014 15:48:01 GMT-0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
